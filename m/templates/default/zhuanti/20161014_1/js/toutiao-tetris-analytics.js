!function(e){function t(e){if(void 0===e)return e;var t,n,r,o,a,i;for(r=e.length,n=0,t="";r>n;){if(o=255&e.charCodeAt(n++),n==r){t+=k.charAt(o>>2),t+=k.charAt((3&o)<<4),t+="==";break}if(a=e.charCodeAt(n++),n==r){t+=k.charAt(o>>2),t+=k.charAt((3&o)<<4|(240&a)>>4),t+=k.charAt((15&a)<<2),t+="=";break}i=e.charCodeAt(n++),t+=k.charAt(o>>2),t+=k.charAt((3&o)<<4|(240&a)>>4),t+=k.charAt((15&a)<<2|(192&i)>>6),t+=k.charAt(63&i)}return t}function n(e){for(var t in e)return!1;return!0}function r(){P=document.createElement("iframe"),P.id="__ToutiaoJSBridgeIframe_SetResult",P.style.display="none",document.documentElement.appendChild(P),x=document.createElement("iframe"),x.id="__ToutiaoJSBridgeIframe",x.style.display="none",document.documentElement.appendChild(x)}function o(){var e=JSON.stringify(L);return L=[],i("SCENE_FETCHQUEUE",e),e}function a(e){var t,n=e.__msg_type,r=e.__params,o=e.__event_id,a=e.__callback_id;return"callback"==n?(t={__err_code:"cb404"},"string"==typeof a&&"function"==typeof q[a]&&(t=q[a](r),delete q[a])):"event"==n&&(t={__err_code:"ev404"},"string"==typeof o&&"function"==typeof J[o]&&(t=J[o](r))),i("SCENE_HANDLEMSGFROMTT",JSON.stringify(t)),JSON.stringify(t)}function i(e,n){P.src=B+"private/setresult/"+e+"&"+t(w.encode(n))}function s(e,t,n){if(n=n||1,e&&"string"==typeof e){var r=(O++).toString();"function"==typeof t&&(q[r]=t);var o={JSSDK:n,func:e,params:{},__msg_type:"call",__callback_id:r};L.push(o),x.src=B+"dispatch_message/"}}function u(e){j.isToutiao()&&(j.getFromSessionStorage("_tt_ad_info_success")?(b=b||j.getFromSessionStorage("_tt_req_id"),_=j.getFromSessionStorage("_tt_device_id"),m=j.getFromSessionStorage("_tt_user_id"),T=j.getFromSessionStorage("_tt_app_version"),C=C||j.getFromSessionStorage("_tt_cid"),N=4):getTTInfo({key:"appInfo",success:function(t){"string"==typeof t&&(t=JSON.parse(t)),_=t.device_id||"",m=t.user_id||"",T=t.appVersion||"",N=1,j.setToSessionStorage("_tt_device_id",_),j.setToSessionStorage("_tt_user_id",m),j.setToSessionStorage("_tt_app_version",T),getTTInfo({key:"adInfo",success:function(t){var n;t||(t={}),"string"==typeof t&&(t=JSON.parse(t)),j.setToSessionStorage("_tt_ad_info_success",!0),C=C||t.cid||t.ad_id||"",n=JSON.parse(t.log_extra||""),b=n.req_id||"",N=2,j.setToSessionStorage("_tt_cid",C),j.setToSessionStorage("_tt_req_id",b),e()},fail:function(){M.doConsume("success")},error:function(){M.doConsume("success")}})},fail:function(){M.doConsume("fail")},error:function(){M.doConsume("error")}}))}function c(){var e=F.getElementByAttr(document,"tt-data-show");e.length&&R(e[0]);var t={};t.page_url=_g_page_url||location.href,t.event_type="performance",t.page_type=E,_taq.push(t),M.transferQueue(!0)}var g,d,f,l,p,_,m,v,h=1,y=2e3,S=!1,A=!1,C="",b="",E=e._page_type?e._page_type:0,T="",I=!1,N=0;_tt_config=e._tt_config,_taq=e._taq||[],_g_page_url=e._g_page_url;var x,P,Q=[],w={encode:function(e){e=e||"",e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},decode:function(e){for(var t="",n=0,r=c1=c2=0;n<e.length;)r=e.charCodeAt(n),128>r?(t+=String.fromCharCode(r),n++):r>191&&224>r?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return t}},k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=[],O=1e3,q={},J={},B="bytedance://";e.ToutiaoJSBridge={_fetchQueue:o,_handleMessageFromToutiao:a},r(),e.getTTInfo=function(e){var t=e.key,r=navigator.userAgent.match(/JSSDK\/([\d.]+)/i),o=r?r[1]:1,a=e.error,i=e.success,u=e.fail;s(t,function(e){e=e||{};var t=e.code;n(e)?t=1:void 0==t&&(t=1),-1==t&&a&&a(e),0==t&&u&&u(e),1==t&&i&&i(e)},o)};var j={getUA:function(){var t={ipad:/ipad/gi.test(navigator.appVersion),iphone:/iphone/gi.test(navigator.appVersion),android:/android/gi.test(navigator.userAgent),nexusS:-1!=e.navigator.userAgent.indexOf(/Nexus\s*S/gi),miui:/MiuiBrowser/i.test(navigator.userAgent),huaWei:/huawei/i.test(navigator.userAgent),safari:/Safari/i.test(navigator.userAgent)&&/iPhone\sOS/.test(navigator.userAgent),weixin:/MicroMessenger/gi.test(navigator.userAgent),UC:/UC/i.test(navigator.userAgent)||/UC/i.test(navigator.appVersion),Baidu:/baidubrowser/i.test(navigator.userAgent)||/baiduboxapp/i.test(navigator.userAgent),QQ:/QQBrowser/i.test(navigator.userAgent)},n="";for(var r in t)t[r]&&(n=r);return n},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isToutiao:function(){var e="http://nativeapp.toutiao.com"==document.referrer||/(News|NewsSocial|Explore|NewsArticle)( |\/)(\d.\d.\d)/i.test(navigator.userAgent);return e},getLocationParam:function(t){var n={QueryString:function(t){var n=e.location.href,r=new RegExp(""+t+"=([^&?]*)","ig");return n.match(r)?decodeURI(n.match(r)[0].substr(t.length+1)):""}};return n.QueryString(t)},queryToJson:function(e){for(var t,n,r,o,a=e.substr(e.lastIndexOf("?")+1),i=a.split("&"),s=i.length,u={},c=0;s>c;c++)i[c]&&(o=i[c].split("="),t=o[0],n=o[1],r=u[t],"undefined"==typeof r?u[t]=n:this.isArray(r)?r.push(n):u[t]=[r,n]);return u},jsonToQuery:function(e){var t=[];e=e||{};var n=/^(?:string|boolean|number)/i;for(var r in e)e.hasOwnProperty(r)&&n.test(typeof e[r])&&t.push(r+"="+e[r]);return t.join("&")},extend:function(e,t){for(var n in t)e[n]=t[n]},getAdId:function(){var e=j.getLocationParam("_tt_ad_id")||j.getLocationParam("ad_id")||j.getLocationParam("aid");return e},encodeParams:function(e){var t=[];e=e||{};var n=/^(?:string|boolean|number)/i;for(var r in e)if(e.hasOwnProperty(r)&&n.test(typeof e[r])){var o=decodeURIComponent(e[r]);t.push(encodeURIComponent(r)+"="+encodeURIComponent(o))}return t.join("&")},jsonp:function(t){if(t=t||{},!t.url||!t.callback)throw new Error("参数不合法");var n=("jsonp_"+Math.random()).replace(".",""),r=document.getElementsByTagName("head")[0];t.data[t.callback]=n;var o=this.encodeParams(t.data),a=document.createElement("script");r.appendChild(a),e[n]=function(o){r.removeChild(a),clearTimeout(a.timer),e[n]=null,t.success&&t.success(o)},a.src=t.url+"?"+o,t.time&&(a.timer=setTimeout(function(){e[n]=null,r.removeChild(a),t.fail&&t.fail({message:"超时"})},t.time))},syncGet:function(e){var t=new XMLHttpRequest;t.open("GET",e.url,!1),t.withCredentials=!0,t.send(null)},addLoadEvent:function(t){var n=e.onload;e.onload="function"!=typeof e.onload?t:function(){n(),t()}},getSiteId:function(){var t=e.location.pathname,n=/\d+/g,r=t.match(n)||[];return r[0]||""},setToSessionStorage:function(t,n){var r=e.sessionStorage;r.setItem(t,n)},getFromSessionStorage:function(t){var n=e.sessionStorage;return n.getItem(t)}},F={getChildrenIndex:function(e){if(e.sourceIndex)return e.sourceIndex-e.parentNode.sourceIndex-1;for(var t=0;e=e.previousElementSibling;)t++;return t},getXPath:function(e){for(var t="";e.length;){var n=Array.prototype.pop.apply(e);n&&n.tagName&&"body"!=n.tagName.toLowerCase()&&"html"!=n.tagName.toLowerCase()&&(t+=n.tagName.toLowerCase()+this.getChildrenIndex(n)+(0==e.length?"":">"))}return t},getElementByAttr:function(e,t){if("string"==typeof e&&(e=document.getElementById(e)),e||(e=document),e.querySelectorAll){var n=e.querySelectorAll("["+t+"]");return n=Array.prototype.slice.call(n)}for(var r=e.getElementsByTagName("*"),o=r.length,a=0,i=[];o>a;a++){var s=r[a];s.getAttribute(t)&&i.push(s)}return i},getPerformanceObj:function(){if(!e.performance)return"";var t=performance.timing;return t},getDomCount:function(){return document.getElementsByTagName("*").length},getElementParentsAndSelf:function(e){var t=this.getElementParents(e);return t.unshift(e),t},getElementParents:function(e){for(var t=[];e;)e=e.parentNode,e&&t.push(e);return t},delegate:function(t,n,r,o){function a(n){var a=/^\[(.*)\]$/,s=e.event?e.event:n,u=s.target||s.srcElement;if(a.test(r))for(var c=r.match(a)[1],g=F.getElementByAttr(t,c),d=u;d;){if(i.inElement(d,g)){o.call(u,s);break}d=d.parentNode}}if("string"==typeof t&&(t=document.getElementById(t)),t||(t=document),r&&"function"==typeof o){var i=this;t[n]=a}},inElement:function(e,t){for(var n=t.length,r=0;n>r;r++)if(e==t[r])return!0;return!1}},U=E?j.getSiteId():"",D=j.queryToJson(location.href);b=D.req_id||"",C=D.cid||"";var M={send:function(e){var t={},n=this;for(var r in e)if("target"==r){var o=n.getPosition(e[r]);j.extend(t,o)}else t[r]=e[r];Q.push(t),Q.length<h||this.consumeQueue()},transferQueue:function(t){for(var n=this;_taq.length;){var r=_taq.shift();if(r.event_type){var o=r.page_url||_g_page_url||e.location.href,a=r.event_type||"",i=r.event_value||"",s=r.target||"",u=r.options||{};cur_page_type=r.page_type,o||console.log("error: page is null"),a||console.log("error: etype is null"),"performance"==a&&(u.performance=F.getPerformanceObj()),"performance"==a||s||console.log("error: target is null");var c={page_url:o,event_type:a,page_type:cur_page_type,event_value:i,options:u};if(s){var g=n.getPosition(s);j.extend(c,g)}Q.push(c)}else"debug"==r[0]?I=!0:console.log("push type error")}return t?void this.consumeQueue():void(Q.length>=h?this.consumeQueue():I&&console.log("left_info: "+JSON.stringify(Q)+"\nlength: "+Q.length))},consumeQueue:function(){var e=this;if(2!=N&&4!=N){var t=setTimeout(function(){e.consumingQueue(e)},2e3);u(function(){clearTimeout(t),e.consumingQueue(e)})}else e.consumingQueue(e)},consumingQueue:function(e){e=e||this;var t=Q.length;if(!(0>=t)){var n=e.getDeviceInfo(),r=e.getPageInfo(),o=JSON.stringify(Q);if(o.length<y)j.extend(n,{track_data:o}),j.extend(n,r),n.ad_id=j.getAdId(),Q=[],e.sendLog(n);else{for(var a=[];Q.length;){var i=Q.shift();a.push(i);var s=JSON.stringify(a);s.length>y&&(j.extend(n,{track_data:s}),j.extend(n,r),n.ad_id=j.getAdId(),e.sendLog(n),a=[])}a.length&&(j.extend(n,{track_data:JSON.stringify(a)}),j.extend(n,r),n.ad_id=j.getAdId(),e.sendLog(n))}}},sendLog:function(e){e.track_data=e.track_data&&e.track_data.replace(/&/g,"%26").replace(/#/g,"%23");var t={out:"http://isub.snssdk.com/2/wap/landing_tetris_log/","in":"http://ad.toutiao.com/tetris/landing/log/"},n=E?t.in:t.out;n+="?"+j.jsonToQuery(e)+"&tt_bridge="+N;try{j.syncGet({url:n})}catch(r){}},doConsume:function(e){S=!0,clearTimeout(v),"success"==e?this.transferQueue():"timeout"==e?this.transferQueue():console.log("getAppInfo fail")},getPerformance:function(){A=!0,f=F.getPerformanceObj()},sendPerformance:function(){var e=this.getDeviceInfo();j.extend(e,f),e.dom_count=F.getDomCount(),e.ad_id=j.getAdId()},getPageInfo:function(){var e={};return e.req_id=b,e.cid=C,e.site_id=U,e},getDeviceInfo:function(){var e={};return g&&(e.account_id=g),d&&(e.domain=d),l&&(e.device=l),p&&(e.app=p),_&&(e.device_id=_),m&&(e.user_id=m),e.client_version=T,e},getPosition:function(t){if(t){var n=e.innerWidth||document.body.clientWidth,r=t.offsetLeft,o=t.offsetHeight,a=320,i=F.getElementParentsAndSelf(t),s={ox:r,oy:o,tx:~~(r*a/n),ty:~~(o*a/n),xpath:F.getXPath(i)};return s}}},R=function(t){var n={};n.page_url=t.getAttribute("tt-data-url")||_g_page_url||e.location.href,n.page_type=E,n.event_type=t.getAttribute("tt-data-eventtype")||"",n.event_value=t.getAttribute("tt-data-eventvalue")||"",n.target=t,n.options=t.getAttribute("tt-data-options")||"",I&&console.log("click_info: "+n),M.send(n)};_taq.pushListener=M.transferQueue;var G=_taq.push;_taq.push=function(){G.apply(this,arguments),"function"==typeof this.pushListener&&S&&this.pushListener.call(M)},e.addEventListener&&e.addEventListener("load",function(){setTimeout(function(){c()},0)}),v=setTimeout(function(){M.doConsume("timeout")},1500),document.addEventListener("click",function(e){for(var t=e.target,n=t;t!=document;)t.hasAttribute("tt-data-click")&&R(t),t=t.parentNode;if(t==document&&!_tt_config){var r={};r.target=n,r.event_type="action_stat",r.page_url=_g_page_url||location.href,r.page_type=E,M.send(r)}},!1),e.ta=M}(window,document);